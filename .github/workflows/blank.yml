name: Wechat steps update

on:
  schedule:
    - cron: '0 13 * * *'  # æ¯å¤© UTC 13 ç‚¹ï¼Œå³åŒ—äº¬æ—¶é—´ 21 ç‚¹ï¼ˆæ™šä¸Š9ç‚¹ï¼‰
  workflow_dispatch:

jobs:
  update-steps:
    runs-on: ubuntu-latest
    steps:
      - name: Submit steps for all accounts
        run: |
          API_URL="$API_URL"
          STEP_MIN="$STEP_MIN"
          STEP_MAX="$STEP_MAX"
          IFS=';' read -ra ACC_ARR <<< "$STEP_ACCOUNTS"
          for acc in "${ACC_ARR[@]}"; do
            EMAIL="${acc%%:*}"
            PASSWORD="${acc#*:}"
            RANGE=$((STEP_MAX - STEP_MIN + 1))
            RANDOM_STEP=$((RANDOM % RANGE + STEP_MIN))
            echo "ğŸ’¡ Steps submitted: $RANDOM_STEP"
            curl -s -X POST "$API_URL" \
              -H "accept: */*" \
              -H "user-agent: Mozilla/5.0" \
              --form "account=$EMAIL" \
              --form "password=$PASSWORD" \
              --form "steps=$RANDOM_STEP"
          done
        env:
          STEP_ACCOUNTS: ${{ secrets.STEP_ACCOUNTS }}
          STEP_MIN: ${{ vars.STEP_MIN }}
          STEP_MAX: ${{ vars.STEP_MAX }}
          API_URL: ${{ vars.API_URL }}
